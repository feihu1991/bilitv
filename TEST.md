# BiliTV 测试文档

## 测试概述

本文档描述BiliTV应用的自动化测试策略和测试用例。

## 测试环境

### 硬件要求
- 小米电视 Redmi G Pro 27U 或其他Android TV设备
- 电视遥控器（用于手动测试）
- PC（用于运行自动化测试）

### 软件要求
- Android SDK 34
- Espresso 3.x
- UI Automator 2.x
- JUnit 4

## 测试分类

### 1. 单元测试
测试各个独立组件的功能。

### 2. 集成测试
测试多个组件协作的功能。

### 3. UI测试
测试用户界面交互，使用Espresso和UI Automator。

### 4. 遥控器测试
测试电视遥控器的按键响应。

### 5. 性能测试
测试应用的性能指标。

### 6. 兼容性测试
测试在不同设备和配置下的兼容性。

### 7. 端到端（E2E）测试
测试完整的用户使用流程。

## 测试用例

### MainActivityTest

#### TC-01: 应用启动测试
**描述**: 验证应用能够正常启动并显示主界面
**步骤**:
1. 启动应用
2. 检查主浏览Fragment是否显示
**预期结果**: 主浏览Fragment成功显示

#### TC-02: 遥控器方向键导航测试
**描述**: 验证遥控器方向键能够正确导航
**步骤**:
1. 启动应用
2. 按下右方向键
3. 按下下方向键
4. 按下右方向键
**预期结果**: 焦点能够正确移动

#### TC-03: 视频选择测试
**描述**: 验证按下确认键能够播放视频
**步骤**:
1. 启动应用
2. 按下右方向键选择一个视频
3. 按下确认键
**预期结果**: 视频播放器Activity启动

#### TC-04: 返回键测试
**描述**: 验证返回键功能
**步骤**:
1. 启动应用
2. 按下返回键
**预期结果**: 应用退出或导航到上一级

#### TC-05: 菜单键测试
**描述**: 验证菜单键功能
**步骤**:
1. 启动应用
2. 按下菜单键
**预期结果**: 设置菜单显示（当前为占位）

### VideoPlayerActivityTest

#### TC-06: 视频播放器启动测试
**描述**: 验证视频播放器能够正常启动
**步骤**:
1. 从主界面选择一个视频
2. 按下确认键
**预期结果**: 视频播放器Activity启动并显示视频

#### TC-07: 播放/暂停测试
**描述**: 验证播放/暂停功能
**步骤**:
1. 进入视频播放界面
2. 按下确认键
3. 观察视频播放状态
4. 再次按下确认键
**预期结果**: 视频在播放和暂停之间切换

#### TC-08: 控制面板显示测试
**描述**: 验证按下方向键显示控制面板
**步骤**:
1. 进入视频播放界面
2. 等待控制面板自动隐藏
3. 按下任意方向键
**预期结果**: 控制面板重新显示

#### TC-09: 弹幕显示测试
**描述**: 验证弹幕能够正常显示
**步骤**:
1. 进入视频播放界面
2. 播放视频
**预期结果**: 弹幕从右向左滚动显示

#### TC-10: 弹幕开关测试
**描述**: 验证弹幕开关功能
**步骤**:
1. 进入视频播放界面
2. 导航到弹幕开关按钮
3. 按下确认键
4. 再次按下确认键
**预期结果**: 弹幕显示/隐藏切换

#### TC-11: 4K视频播放测试
**描述**: 验证4K视频能够正常播放
**步骤**:
1. 选择一个4K视频
2. 播放视频
3. 检查视频分辨率
**预期结果**: 视频分辨率至少为3840x2160

### LivePlayerActivityTest

#### TC-12: 直播播放器启动测试
**描述**: 验证直播播放器能够正常启动
**步骤**:
1. 从主界面选择一个直播
2. 按下确认键
**预期结果**: 直播播放器Activity启动

#### TC-13: 直播标识显示测试
**描述**: 验证直播标识正确显示
**步骤**:
1. 进入直播播放界面
**预期结果**: 显示"LIVE"标识

#### TC-14: 实时弹幕测试
**描述**: 验证实时弹幕显示
**步骤**:
1. 进入直播播放界面
2. 观察弹幕
**预期结果**: 弹幕持续更新显示

#### TC-15: 观众数量更新测试
**描述**: 验证观众数量实时更新
**步骤**:
1. 进入直播播放界面
2. 观察观众数量
**预期结果**: 观众数量定期更新

### DanmakuManagerTest

#### TC-16: 弹幕添加测试
**描述**: 验证能够添加单条弹幕
**步骤**:
1. 创建DanmakuManager
2. 添加一条弹幕文本
**预期结果**: 弹幕成功添加并显示

#### TC-17: 弹幕暂停测试
**描述**: 验证弹幕暂停功能
**步骤**:
1. 创建DanmakuManager并添加弹幕
2. 调用pause()
**预期结果**: 弹幕停止滚动

#### TC-18: 弹幕继续测试
**描述**: 验证弹幕继续功能
**步骤**:
1. 创建DanmakuManager并暂停
2. 调用start()
**预期结果**: 弹幕继续滚动

#### TC-19: 弹幕清除测试
**描述**: 验证弹幕清除功能
**步骤**:
1. 创建DanmakuManager并添加多条弹幕
2. 调用clear()
**预期结果**: 所有弹幕被清除

#### TC-20: 弹幕释放测试
**描述**: 验证弹幕资源释放
**步骤**:
1. 创建DanmakuManager
2. 调用release()
**预期结果**: 所有资源被正确释放

### VideoDataTest

#### TC-21: 视频数据模型测试
**描述**: 验证VideoData数据模型
**步骤**:
1. 创建VideoData实例
2. 设置各项属性
3. 验证属性值
**预期结果**: 所有属性正确设置和获取

### PerformanceTest

#### TC-22: 应用启动时间测试
**描述**: 验证应用启动时间
**步骤**:
1. 启动应用
2. 测量从启动到完全显示的时间
**预期结果**: 启动时间 < 3秒

#### TC-23: 视频播放器启动时间测试
**描述**: 验证视频播放器启动时间
**步骤**:
1. 启动视频播放器
2. 测量启动时间
**预期结果**: 启动时间 < 2秒

#### TC-24: 主界面滚动性能测试
**描述**: 验证主界面滚动性能
**步骤**:
1. 在主界面快速滚动
2. 测量滚动时间
**预期结果**: 滚动流畅，无明显延迟

#### TC-25: 弹幕显示性能测试
**描述**: 验证弹幕渲染性能
**步骤**:
1. 播放视频并显示弹幕
2. 观察弹幕流畅度
**预期结果**: 弹幕滚动流畅，无卡顿

#### TC-26: 内存占用测试
**描述**: 验证应用内存占用
**步骤**:
1. 运行应用
2. 检查内存使用情况
**预期结果**: 内存占用 < 最大内存的80%

#### TC-27: 视频缓冲测试
**描述**: 验证视频缓冲性能
**步骤**:
1. 播放视频10秒
2. 检查是否有缓冲卡顿
**预期结果**: 播放流畅，缓冲时间短

### IntegrationTest

#### TC-28: 主界面到视频播放器完整流程测试
**描述**: 验证从主界面到视频播放器的完整流程
**步骤**:
1. 启动应用
2. 导航到视频
3. 选择视频
4. 验证视频播放器启动
**预期结果**: 完整流程无错误

#### TC-29: 直播流程集成测试
**描述**: 验证直播播放完整流程
**步骤**:
1. 导航到直播分类
2. 选择直播
3. 验证直播播放器启动
**预期结果**: 直播流程正常

#### TC-30: 视频播放和弹幕集成测试
**描述**: 验证视频播放和弹幕同时工作的集成
**步骤**:
1. 播放视频
2. 显示弹幕
3. 操作控制面板
**预期结果**: 视频和弹幕正常工作

#### TC-31: 播放控制集成测试
**描述**: 验证播放控制功能的集成
**步骤**:
1. 播放视频
2. 测试播放/暂停
3. 测试弹幕开关
4. 测试画质按钮
**预期结果**: 所有控制功能正常

#### TC-32: 返回导航集成测试
**描述**: 验证返回导航的集成
**步骤**:
1. 进入视频播放器
2. 按返回键
3. 验证返回到主界面
**预期结果**: 导航正常

#### TC-33: 4K视频播放集成测试
**描述**: 验证4K视频播放的完整流程
**步骤**:
1. 导航到4K分类
2. 选择4K视频
3. 验证播放和画质标识
**预期结果**: 4K视频正常播放

### CompatibilityTest

#### TC-34: Android版本兼容性测试
**描述**: 验证Android版本兼容性
**步骤**:
1. 检查当前Android版本
2. 验证功能正常
**预期结果**: 支持Android 8.0及以上

#### TC-35: 屏幕方向兼容性测试
**描述**: 验证屏幕方向兼容性
**步骤**:
1. 启动视频播放器
2. 检查屏幕方向
**预期结果**: 强制横屏显示

#### TC-36: 屏幕分辨率兼容性测试
**描述**: 验证屏幕分辨率兼容性
**步骤**:
1. 检查屏幕分辨率
2. 验证界面适配
**预期结果**: 支持至少720P

#### TC-37: Leanback支持测试
**描述**: 验证Leanback支持
**步骤**:
1. 检查系统是否支持Leanback
**预期结果**: 支持Android TV Leanback

#### TC-38: 4K输出支持测试
**描述**: 验证4K输出支持
**步骤**:
1. 检查设备是否支持4K输出
**预期结果**: 记录设备能力

#### TC-39: HDR支持测试
**描述**: 验证HDR支持
**步骤**:
1. 检查设备是否支持HDR
**预期结果**: 记录设备能力

#### TC-40: 硬件加速支持测试
**描述**: 验证硬件加速支持
**步骤**:
1. 检查显示设备特性
2. 验证硬件加速
**预期结果**: 支持硬件加速

#### TC-41: ExoPlayer兼容性测试
**描述**: 验证ExoPlayer兼容性
**步骤**:
1. 初始化ExoPlayer
2. 验证功能正常
**预期结果**: ExoPlayer正常工作

#### TC-42: 触摸屏兼容性测试
**描述**: 验证触摸屏兼容性
**步骤**:
1. 检查触摸屏支持
**预期结果**: 应用不依赖触摸屏

#### TC-43: 网络连接兼容性测试
**描述**: 验证网络连接兼容性
**步骤**:
1. 检查WiFi和Ethernet支持
**预期结果**: 至少支持一种网络方式

### E2ETest

#### E2E-01: 完整视频观看流程
**描述**: 用户从启动应用到观看视频并返回的完整流程
**步骤**:
1. 启动应用
2. 浏览视频
3. 选择视频
4. 播放视频
5. 操作控制
6. 返回主界面
**预期结果**: 完整流程无错误

#### E2E-02: 完整直播观看流程
**描述**: 用户观看直播的完整流程
**步骤**:
1. 启动应用
2. 导航到直播
3. 选择直播
4. 观看直播
5. 返回主界面
**预期结果**: 直播流程正常

#### E2E-03: 多视频连续观看流程
**描述**: 用户连续观看多个视频
**步骤**:
1. 播放第一个视频
2. 返回
3. 播放第二个视频
4. 返回
5. 播放第三个视频
6. 返回
**预期结果**: 多视频切换正常

#### E2E-04: 浏览所有分类流程
**描述**: 用户浏览所有视频分类
**步骤**:
1. 启动应用
2. 浏览推荐视频
3. 浏览4K视频
4. 浏览直播
5. 浏览热门视频
**预期结果**: 所有分类浏览正常

#### E2E-05: 深度导航测试
**描述**: 用户深度使用应用导航功能
**步骤**:
1. 在主界面深度导航
2. 进入视频播放器
3. 在播放器内导航
4. 返回主界面
**预期结果**: 深度导航正常

#### E2E-06: 长时间使用测试
**描述**: 模拟用户长时间使用应用
**步骤**:
1. 连续使用应用30秒
2. 多次播放视频
3. 频繁导航
**预期结果**: 应用稳定运行

#### E2E-07: 错误处理测试
**描述**: 测试各种错误情况下的应用行为
**步骤**:
1. 尝试播放无效URL
2. 验证错误处理
**预期结果**: 应用不崩溃，优雅处理错误

#### E2E-08: 快速操作测试
**描述**: 测试用户快速按键的情况
**步骤**:
1. 快速导航
2. 快速播放/暂停
3. 快速切换功能
**预期结果**: 应用响应正常，无崩溃

## 自动化测试执行

### 运行所有测试
```bash
./gradlew connectedAndroidTest
```

### 运行特定测试类
```bash
# UI测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.MainActivityTest

# 视频播放器测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.VideoPlayerActivityTest

# 直播播放器测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.LivePlayerActivityTest

# 弹幕管理器测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.DanmakuManagerTest

# 数据模型测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.VideoDataTest

# 性能测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.performance.PerformanceTest

# 集成测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.integration.IntegrationTest

# 兼容性测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.compatibility.CompatibilityTest

# 端到端测试
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.e2e.E2ETest
```

### 运行特定测试方法
```bash
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.MainActivityTest#testMainActivityLaunches
```

## 手动测试

### 遥控器测试清单
- [ ] 方向键上下左右导航正常
- [ ] 确认键播放视频正常
- [ ] 返回键退出正常
- [ ] 菜单键功能正常
- [ ] 播放/暂停键正常
- [ ] 停止键正常
- [ ] 音量键正常（如支持）

### 功能测试清单
- [ ] 主界面加载正常
- [ ] 视频卡片显示正常
- [ ] 直播卡片显示正常
- [ ] 4K标识显示正确
- [ ] 视频播放正常
- [ ] 直播播放正常
- [ ] 弹幕显示正常
- [ ] 控制面板显示正常
- [ ] 播放/暂停功能正常

## 性能测试

### 视频播放性能
- 视频启动时间 < 2秒
- 播放流畅无卡顿
- CPU占用率 < 30%

### 弹幕性能
- 同时显示弹幕数 > 100条
- 弹幕滚动流畅
- 内存占用稳定

## 兼容性测试

### 设备测试
- [x] 小米电视 Redmi G Pro 27U
- [ ] 小米电视 6
- [ ] 其他Android TV设备

### 分辨率测试
- [x] 3840x2160 (4K)
- [ ] 1920x1080 (1080P)
- [ ] 1280x720 (720P)

## 测试覆盖率目标

- 单元测试覆盖率 > 80%
- UI测试覆盖率 > 70%
- 集成测试覆盖率 > 60%
- 性能测试覆盖率 > 50%
- E2E测试覆盖率 > 40%

## 测试用例统计

- MainActivityTest: 5个测试用例
- VideoPlayerActivityTest: 6个测试用例
- LivePlayerActivityTest: 7个测试用例
- DanmakuManagerTest: 8个测试用例
- VideoDataTest: 13个测试用例
- PerformanceTest: 6个测试用例
- IntegrationTest: 6个测试用例
- CompatibilityTest: 12个测试用例
- E2ETest: 8个测试用例

**总计: 71个自动化测试用例**

## 问题跟踪

在测试中发现的问题请记录在GitHub Issues中。

## 测试报告

每次完整测试后应生成测试报告，包括：
1. 执行的测试用例
2. 通过/失败数量
3. 发现的问题列表
4. 测试覆盖率
