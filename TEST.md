# BiliTV 测试文档

## 测试概述

本文档描述BiliTV应用的自动化测试策略和测试用例。

## 测试环境

### 硬件要求
- 小米电视 Redmi G Pro 27U 或其他Android TV设备
- 电视遥控器（用于手动测试）
- PC（用于运行自动化测试）

### 软件要求
- Android SDK 34
- Espresso 3.x
- UI Automator 2.x
- JUnit 4

## 测试分类

### 1. 单元测试
测试各个独立组件的功能。

### 2. 集成测试
测试多个组件协作的功能。

### 3. UI测试
测试用户界面交互，使用Espresso和UI Automator。

### 4. 遥控器测试
测试电视遥控器的按键响应。

## 测试用例

### MainActivityTest

#### TC-01: 应用启动测试
**描述**: 验证应用能够正常启动并显示主界面
**步骤**:
1. 启动应用
2. 检查主浏览Fragment是否显示
**预期结果**: 主浏览Fragment成功显示

#### TC-02: 遥控器方向键导航测试
**描述**: 验证遥控器方向键能够正确导航
**步骤**:
1. 启动应用
2. 按下右方向键
3. 按下下方向键
4. 按下右方向键
**预期结果**: 焦点能够正确移动

#### TC-03: 视频选择测试
**描述**: 验证按下确认键能够播放视频
**步骤**:
1. 启动应用
2. 按下右方向键选择一个视频
3. 按下确认键
**预期结果**: 视频播放器Activity启动

#### TC-04: 返回键测试
**描述**: 验证返回键功能
**步骤**:
1. 启动应用
2. 按下返回键
**预期结果**: 应用退出或导航到上一级

#### TC-05: 菜单键测试
**描述**: 验证菜单键功能
**步骤**:
1. 启动应用
2. 按下菜单键
**预期结果**: 设置菜单显示（当前为占位）

### VideoPlayerActivityTest

#### TC-06: 视频播放器启动测试
**描述**: 验证视频播放器能够正常启动
**步骤**:
1. 从主界面选择一个视频
2. 按下确认键
**预期结果**: 视频播放器Activity启动并显示视频

#### TC-07: 播放/暂停测试
**描述**: 验证播放/暂停功能
**步骤**:
1. 进入视频播放界面
2. 按下确认键
3. 观察视频播放状态
4. 再次按下确认键
**预期结果**: 视频在播放和暂停之间切换

#### TC-08: 控制面板显示测试
**描述**: 验证按下方向键显示控制面板
**步骤**:
1. 进入视频播放界面
2. 等待控制面板自动隐藏
3. 按下任意方向键
**预期结果**: 控制面板重新显示

#### TC-09: 弹幕显示测试
**描述**: 验证弹幕能够正常显示
**步骤**:
1. 进入视频播放界面
2. 播放视频
**预期结果**: 弹幕从右向左滚动显示

#### TC-10: 弹幕开关测试
**描述**: 验证弹幕开关功能
**步骤**:
1. 进入视频播放界面
2. 导航到弹幕开关按钮
3. 按下确认键
4. 再次按下确认键
**预期结果**: 弹幕显示/隐藏切换

#### TC-11: 4K视频播放测试
**描述**: 验证4K视频能够正常播放
**步骤**:
1. 选择一个4K视频
2. 播放视频
3. 检查视频分辨率
**预期结果**: 视频分辨率至少为3840x2160

### LivePlayerActivityTest

#### TC-12: 直播播放器启动测试
**描述**: 验证直播播放器能够正常启动
**步骤**:
1. 从主界面选择一个直播
2. 按下确认键
**预期结果**: 直播播放器Activity启动

#### TC-13: 直播标识显示测试
**描述**: 验证直播标识正确显示
**步骤**:
1. 进入直播播放界面
**预期结果**: 显示"LIVE"标识

#### TC-14: 实时弹幕测试
**描述**: 验证实时弹幕显示
**步骤**:
1. 进入直播播放界面
2. 观察弹幕
**预期结果**: 弹幕持续更新显示

#### TC-15: 观众数量更新测试
**描述**: 验证观众数量实时更新
**步骤**:
1. 进入直播播放界面
2. 观察观众数量
**预期结果**: 观众数量定期更新

### DanmakuManagerTest

#### TC-16: 弹幕添加测试
**描述**: 验证能够添加单条弹幕
**步骤**:
1. 创建DanmakuManager
2. 添加一条弹幕文本
**预期结果**: 弹幕成功添加并显示

#### TC-17: 弹幕暂停测试
**描述**: 验证弹幕暂停功能
**步骤**:
1. 创建DanmakuManager并添加弹幕
2. 调用pause()
**预期结果**: 弹幕停止滚动

#### TC-18: 弹幕继续测试
**描述**: 验证弹幕继续功能
**步骤**:
1. 创建DanmakuManager并暂停
2. 调用start()
**预期结果**: 弹幕继续滚动

#### TC-19: 弹幕清除测试
**描述**: 验证弹幕清除功能
**步骤**:
1. 创建DanmakuManager并添加多条弹幕
2. 调用clear()
**预期结果**: 所有弹幕被清除

#### TC-20: 弹幕释放测试
**描述**: 验证弹幕资源释放
**步骤**:
1. 创建DanmakuManager
2. 调用release()
**预期结果**: 所有资源被正确释放

### VideoDataTest

#### TC-21: 视频数据模型测试
**描述**: 验证VideoData数据模型
**步骤**:
1. 创建VideoData实例
2. 设置各项属性
3. 验证属性值
**预期结果**: 所有属性正确设置和获取

## 自动化测试执行

### 运行所有测试
```bash
./gradlew connectedAndroidTest
```

### 运行特定测试类
```bash
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.MainActivityTest
```

### 运行特定测试方法
```bash
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.flashfinger.bilitv.MainActivityTest#testMainActivityLaunches
```

## 手动测试

### 遥控器测试清单
- [ ] 方向键上下左右导航正常
- [ ] 确认键播放视频正常
- [ ] 返回键退出正常
- [ ] 菜单键功能正常
- [ ] 播放/暂停键正常
- [ ] 停止键正常
- [ ] 音量键正常（如支持）

### 功能测试清单
- [ ] 主界面加载正常
- [ ] 视频卡片显示正常
- [ ] 直播卡片显示正常
- [ ] 4K标识显示正确
- [ ] 视频播放正常
- [ ] 直播播放正常
- [ ] 弹幕显示正常
- [ ] 控制面板显示正常
- [ ] 播放/暂停功能正常

## 性能测试

### 视频播放性能
- 视频启动时间 < 2秒
- 播放流畅无卡顿
- CPU占用率 < 30%

### 弹幕性能
- 同时显示弹幕数 > 100条
- 弹幕滚动流畅
- 内存占用稳定

## 兼容性测试

### 设备测试
- [x] 小米电视 Redmi G Pro 27U
- [ ] 小米电视 6
- [ ] 其他Android TV设备

### 分辨率测试
- [x] 3840x2160 (4K)
- [ ] 1920x1080 (1080P)
- [ ] 1280x720 (720P)

## 测试覆盖率目标

- 单元测试覆盖率 > 80%
- UI测试覆盖率 > 70%

## 问题跟踪

在测试中发现的问题请记录在GitHub Issues中。

## 测试报告

每次完整测试后应生成测试报告，包括：
1. 执行的测试用例
2. 通过/失败数量
3. 发现的问题列表
4. 测试覆盖率
